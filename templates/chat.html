<!DOCTYPE html>
<html>
<head>
    <title>Chat en ligne</title>
    <script src="https://cdn.socket.io/3.1.3/socket.io.min.js"></script>
</head>
<body>
    <h2>Bienvenue dans le chat !</h2>
        <div id="login">
        <input id="pseudo" autocomplete="off" placeholder="Choisis ton pseudo..." />
        <button onclick="enterChat()">Entrer</button>
    </div>

    <div id="chat" style="display:none;">
        <p>Utilisateurs en ligne : <span id="userCount">0</span></p>
        <ul id="messages"></ul>
        <input id="message" autocomplete="off" placeholder="Tape ton message..." />
        <button onclick="sendMessage()">Envoyer</button>
    </div>

    <script>
        var socket = io();
        var pseudo = null;

        function enterChat() {
            var inputPseudo = document.getElementById('pseudo');
            if (inputPseudo.value.trim() !== "") {
                pseudo = inputPseudo.value.trim();
                document.getElementById('login').style.display = "none"; // cache la zone login
                document.getElementById('chat').style.display = "block"; // affiche le chat
            } else {
                alert("Veuillez entrer un pseudo !");
            }
        }

        socket.on('message', function(msg){
            var item = document.createElement('li');
            item.textContent = msg;
            document.getElementById('messages').appendChild(item);
        });

        function sendMessage() {
            var input = document.getElementById('message');
            if (input.value.trim() !== "" && pseudo) {
                socket.send(pseudo + " : " + input.value);
                input.value = '';
            }
        }

        document.getElementById('message').addEventListener('keydown', function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                sendMessage();
            }
        });

        socket.on('user_count', function(count) {
            document.getElementById('userCount').textContent = count;
        });
    </script>
</body>
</html>
